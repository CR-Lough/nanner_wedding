<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Testing File Uploads</title>
    <link
      href="https://unpkg.com/tailwindcss@^2/dist/tailwind.min.css"
      rel="stylesheet"
    />
  </head>
  <body>
    <section
      class="max-w-4xl mt-4 w-11/12 mx-auto bg-blue-50 p-8 shadow-lg rounded-lg"
    >
      <h1 class="text-3xl font-semibold text-center">Add an Post</h1>
      <form>
        <fieldset class="my-2">
          <label class="w-full block uppercase ml-3 mb-3" for="title">
            Title
          </label>
          <input
            type="text"
            name="title"
            id="title"
            class="w-full block p-3 shadow-sm"
            placeholder="Title"
          />
        </fieldset>
        <fieldset class="my-2">
          <label class="w-full block uppercase ml-3 mb-0" for="image">
            Image
          </label>
          <input
            type="file"
            name="image"
            id="image"
            class="w-full block p-3"
            placeholder="image"
          />
        </fieldset>
        <button
          class="w-full block p-3 bg-green-400 hover:bg-green-500 text-center transition duration-200"
          type="submit"
        >
          Create Post
        </button>
      </form>
    </section>
  </body>
</html>

<script type="text/javascript">
  document.addEventListener('DOMContentLoaded', () => {
    document.addEventListener('submit', (e) => {
      e.preventDefault()
      const form = e.target
      const formData = new FormData()
      formData.append('post[title]', form.title.value)
      formData.append('post[image]', form.image.files[0], form.image.value)
    })
  })
</script>

<section
  class="max-w-4xl mt-4 w-11/12 mx-auto bg-blue-50 p-8 shadow-lg rounded-lg grid grid-cols-2 gap-2"
  id="results"
></section>

<script type="text/javascript">
  document.addEventListener('DOMContentLoaded', () => {
    const container = document.querySelector('#results')
    document.addEventListener('submit', (e) => {
      e.preventDefault()
      const form = e.target
      const formData = new FormData()
      formData.append('post[title]', form.title.value)
      for (let i = 0; i < form.poster.files.length; i++) {
        formData.append(
          'post[image][]',
          form.image.files[i],
          form.image.files[i].title
        )
      }

      fetch('http://localhost:3000/events', {
        method: 'post',
        body: formData,
      })
        .then((res) => res.json())
        .then((post) => {
          const postDiv = document.createElement('div')
          postDiv.className = 'shadow bg-green-50 p-3'
          postDiv.innerHTML = `
          <h1 class="post-title text-2xl"></h1>
          <img class="post-image w-full block" />  
          `
          eventDiv.querySelector('.post-title').textContent = post.title
          eventDiv.querySelector(
            '.post-images'
          ).innerHTML = post.poster_urls
            .map((url) => `<img src="${url}" />`)
            .join('')
          postDiv.querySelector('.post-title').textContent = post.title

          container.appendChild(postDiv)
        })
    })
  })
</script>
